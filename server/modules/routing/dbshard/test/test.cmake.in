set(DBSHARD_TEST_PORTS 3000 3001 3002 3003)
foreach(VAR ${DBSHARD_TEST_PORTS})
  execute_process(COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/prepare_shard.sh @TEST_HOST@ ${VAR} @TEST_USER@ @TEST_PASSWORD@ "db${VAR}")
endforeach()
execute_process(COMMAND ${CMAKE_CURRENT_BINARY_DIR}/testdbshard @TEST_HOST@ @TEST_PORT_DB@ @TEST_USER@ @TEST_PASSWORD@ RESULT_VARIABLE RVAL)
if(RVAL EQUAL 0)
  message("Test passed.")
else()
  message(FATAL_ERROR "Test failed.")
endif()
