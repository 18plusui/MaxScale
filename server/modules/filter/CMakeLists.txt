find_package(RabbitMQ)
if(RABBITMQ_FOUND)
  include_directories(${RABBITMQ_HEADERS})
  add_library(mqfilter SHARED mqfilter.c)
  target_link_libraries(mqfilter maxscale-common ${RABBITMQ_LIBRARIES})
  add_dependencies(mqfilter pcre2)
  set_target_properties(mqfilter PROPERTIES VERSION "1.0.2")
  install_module(mqfilter core)
else()
  message(WARNING "Could not find librabbitmq, the mqfilter will not be built.")
endif()

add_library(regexfilter SHARED regexfilter.c)
target_link_libraries(regexfilter maxscale-common)
add_dependencies(regexfilter pcre2)
set_target_properties(regexfilter PROPERTIES VERSION "1.1.0")
install_module(regexfilter core)

add_library(testfilter SHARED testfilter.c)
target_link_libraries(testfilter maxscale-common)
set_target_properties(testfilter PROPERTIES VERSION "1.0.0")
install_module(testfilter core)

add_library(gatekeeper SHARED gatekeeper.c)
target_link_libraries(gatekeeper maxscale-common)
set_target_properties(gatekeeper PROPERTIES VERSION "1.0.0")
install_module(gatekeeper experimental)

add_library(qlafilter SHARED qlafilter.c)
target_link_libraries(qlafilter maxscale-common)
set_target_properties(qlafilter PROPERTIES VERSION "1.1.1")
install_module(qlafilter core)

add_library(tee SHARED tee.c)
target_link_libraries(tee maxscale-common)
set_target_properties(tee PROPERTIES VERSION "1.0.0")
install_module(tee core)

add_library(topfilter SHARED topfilter.c)
target_link_libraries(topfilter maxscale-common)
set_target_properties(topfilter PROPERTIES VERSION "1.0.1")
install_module(topfilter core)

find_package(Lua)
if(LUA_FOUND)
  include_directories(${LUA_INCLUDE_DIR})
  add_library(luafilter SHARED luafilter.c)
  set_target_properties(luafilter PROPERTIES VERSION "1.0.0")
  target_link_libraries(luafilter maxscale-common ${LUA_LIBRARIES})
  install_module(luafilter experimental)
else()
  message(STATUS "Lua was not found, luafilter will not be built.")
endif()

add_library(namedserverfilter SHARED namedserverfilter.c)
target_link_libraries(namedserverfilter maxscale-common)
set_target_properties(namedserverfilter PROPERTIES VERSION "1.1.0")
install_module(namedserverfilter core)

add_library(ccrfilter SHARED ccrfilter.c)
target_link_libraries(ccrfilter maxscale-common)
set_target_properties(ccrfilter PROPERTIES VERSION "1.0.0")
install_module(ccrfilter experimental)

add_subdirectory(hint)
add_subdirectory(dbfwfilter)
